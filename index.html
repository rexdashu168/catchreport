<!DOCTYPE html>

<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>åˆ¸å•†ç ”ç©¶å ±å‘Šè³‡æ–™åº«</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }

```
    body {
        font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Microsoft JhengHei", sans-serif;
        background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
        min-height: 100vh;
        color: #e8e8e8;
    }
    
    .container {
        max-width: 1400px;
        margin: 0 auto;
        padding: 20px;
    }
    
    .header {
        text-align: center;
        padding: 30px 0 20px;
        border-bottom: 1px solid rgba(255,255,255,0.1);
        margin-bottom: 25px;
    }
    
    .header h1 {
        font-size: 28px;
        background: linear-gradient(90deg, #00d4ff, #7b68ee);
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
        background-clip: text;
        margin-bottom: 8px;
    }
    
    .header .subtitle {
        color: #888;
        font-size: 14px;
    }
    
    .update-info {
        display: flex;
        justify-content: center;
        gap: 20px;
        margin-top: 15px;
        font-size: 13px;
        color: #666;
    }
    
    /* è¼‰å…¥ç‹€æ…‹ */
    .loading-overlay {
        position: fixed;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background: rgba(26,26,46,0.95);
        display: flex;
        flex-direction: column;
        justify-content: center;
        align-items: center;
        z-index: 9999;
    }
    
    .loading-overlay.hidden {
        display: none;
    }
    
    .loading-spinner {
        width: 50px;
        height: 50px;
        border: 3px solid rgba(0,212,255,0.2);
        border-top-color: #00d4ff;
        border-radius: 50%;
        animation: spin 1s linear infinite;
        margin-bottom: 20px;
    }
    
    @keyframes spin {
        to { transform: rotate(360deg); }
    }
    
    .loading-text {
        color: #888;
        font-size: 14px;
    }
    
    .error-message {
        text-align: center;
        padding: 60px 20px;
        color: #ff6b6b;
    }
    
    .error-message h2 {
        margin-bottom: 15px;
    }
    
    .retry-btn {
        margin-top: 20px;
        padding: 12px 30px;
        background: linear-gradient(90deg, #00d4ff, #7b68ee);
        border: none;
        border-radius: 8px;
        color: #fff;
        font-size: 14px;
        cursor: pointer;
    }
    
    /* æœå°‹ç¯©é¸å€ */
    .search-section {
        background: rgba(255,255,255,0.03);
        border: 1px solid rgba(255,255,255,0.1);
        border-radius: 12px;
        padding: 20px;
        margin-bottom: 25px;
    }
    
    .search-row {
        display: flex;
        gap: 15px;
        flex-wrap: wrap;
        margin-bottom: 15px;
    }
    
    .search-input-wrapper {
        flex: 2;
        min-width: 250px;
        position: relative;
    }
    
    .search-input-wrapper::before {
        content: "ğŸ”";
        position: absolute;
        left: 12px;
        top: 50%;
        transform: translateY(-50%);
        font-size: 16px;
    }
    
    #searchInput {
        width: 100%;
        padding: 12px 12px 12px 40px;
        border: 1px solid rgba(255,255,255,0.15);
        border-radius: 10px;
        background: rgba(0,0,0,0.3);
        color: #fff;
        font-size: 15px;
    }
    
    #searchInput:focus {
        outline: none;
        border-color: #00d4ff;
        box-shadow: 0 0 0 3px rgba(0,212,255,0.1);
    }
    
    .filter-select {
        flex: 1;
        min-width: 150px;
    }
    
    .filter-select select {
        width: 100%;
        padding: 12px;
        border: 1px solid rgba(255,255,255,0.15);
        border-radius: 10px;
        background: rgba(0,0,0,0.3);
        color: #fff;
        font-size: 14px;
        cursor: pointer;
    }
    
    .filter-select select:focus {
        outline: none;
        border-color: #00d4ff;
    }
    
    .tags-section {
        display: flex;
        flex-wrap: wrap;
        gap: 8px;
        align-items: center;
    }
    
    .tags-label {
        font-size: 13px;
        color: #888;
        margin-right: 5px;
    }
    
    .tag {
        padding: 6px 14px;
        background: rgba(255,255,255,0.08);
        border: 1px solid rgba(255,255,255,0.15);
        border-radius: 20px;
        font-size: 13px;
        color: #ccc;
        cursor: pointer;
        transition: all 0.2s;
    }
    
    .tag:hover {
        background: rgba(0,212,255,0.15);
        border-color: rgba(0,212,255,0.4);
    }
    
    .tag.active {
        background: linear-gradient(90deg, rgba(0,212,255,0.3), rgba(123,104,238,0.3));
        border-color: #00d4ff;
        color: #fff;
    }
    
    .clear-btn {
        padding: 6px 14px;
        background: rgba(255,107,107,0.2);
        border: 1px solid rgba(255,107,107,0.4);
        border-radius: 20px;
        font-size: 13px;
        color: #ff6b6b;
        cursor: pointer;
        margin-left: auto;
    }
    
    .clear-btn:hover {
        background: rgba(255,107,107,0.3);
    }
    
    .stats-bar {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 12px 0;
        margin-bottom: 20px;
        border-bottom: 1px solid rgba(255,255,255,0.1);
    }
    
    .stats-text {
        font-size: 14px;
        color: #888;
    }
    
    .stats-text strong {
        color: #00d4ff;
    }
    
    /* å ±å‘Šåˆ—è¡¨ */
    .reports-grid {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(380px, 1fr));
        gap: 20px;
    }
    
    .report-card {
        background: rgba(255,255,255,0.04);
        border: 1px solid rgba(255,255,255,0.1);
        border-radius: 16px;
        padding: 20px;
        cursor: pointer;
        transition: all 0.3s;
    }
    
    .report-card:hover {
        transform: translateY(-3px);
        border-color: rgba(0,212,255,0.4);
        box-shadow: 0 10px 30px rgba(0,0,0,0.3);
    }
    
    .card-header {
        display: flex;
        justify-content: space-between;
        align-items: flex-start;
        margin-bottom: 12px;
    }
    
    .card-broker {
        font-size: 12px;
        color: #00d4ff;
        padding: 3px 10px;
        background: rgba(0,212,255,0.15);
        border-radius: 12px;
    }
    
    .card-date {
        font-size: 12px;
        color: #666;
    }
    
    .card-title {
        font-size: 18px;
        font-weight: 600;
        color: #fff;
        margin-bottom: 6px;
        line-height: 1.4;
    }
    
    .card-subtitle {
        font-size: 14px;
        color: #888;
        margin-bottom: 12px;
    }
    
    .card-industry {
        display: inline-block;
        font-size: 12px;
        color: #7b68ee;
        padding: 4px 12px;
        background: rgba(123,104,238,0.15);
        border-radius: 10px;
        margin-bottom: 15px;
    }
    
    .card-rating {
        display: flex;
        align-items: center;
        gap: 8px;
        margin-bottom: 15px;
    }
    
    .rating-label {
        font-size: 12px;
        color: #888;
    }
    
    .rating-value {
        font-size: 13px;
        font-weight: 600;
        padding: 3px 10px;
        border-radius: 8px;
    }
    
    .rating-value.positive {
        background: rgba(81,207,102,0.2);
        color: #51cf66;
    }
    
    .rating-value.neutral {
        background: rgba(255,193,7,0.2);
        color: #ffc107;
    }
    
    .card-highlights {
        border-top: 1px solid rgba(255,255,255,0.08);
        padding-top: 12px;
    }
    
    .highlight-item {
        font-size: 13px;
        color: #aaa;
        padding: 4px 0;
        padding-left: 15px;
        position: relative;
        line-height: 1.5;
    }
    
    .highlight-item::before {
        content: "â€¢";
        position: absolute;
        left: 0;
        color: #00d4ff;
    }
    
    .card-stocks {
        display: flex;
        flex-wrap: wrap;
        gap: 6px;
        margin-top: 12px;
    }
    
    .stock-tag {
        font-size: 11px;
        padding: 3px 8px;
        background: rgba(255,255,255,0.08);
        border-radius: 6px;
        color: #ccc;
    }
    
    /* å½ˆçª— */
    .modal-overlay {
        position: fixed;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background: rgba(0,0,0,0.85);
        z-index: 1000;
        display: none;
        overflow-y: auto;
        padding: 30px 20px;
    }
    
    .modal-overlay.active {
        display: block;
    }
    
    .modal-content {
        max-width: 900px;
        margin: 0 auto;
        background: linear-gradient(135deg, #1e1e30 0%, #252540 100%);
        border: 1px solid rgba(255,255,255,0.15);
        border-radius: 20px;
        overflow: hidden;
    }
    
    .modal-header {
        padding: 25px 30px;
        background: rgba(0,0,0,0.3);
        border-bottom: 1px solid rgba(255,255,255,0.1);
        display: flex;
        justify-content: space-between;
        align-items: flex-start;
    }
    
    .modal-header-info {
        flex: 1;
    }
    
    .modal-broker-date {
        display: flex;
        gap: 15px;
        margin-bottom: 10px;
        font-size: 13px;
    }
    
    .modal-broker {
        color: #00d4ff;
    }
    
    .modal-date {
        color: #888;
    }
    
    .modal-title {
        font-size: 24px;
        font-weight: 600;
        color: #fff;
        margin-bottom: 5px;
    }
    
    .modal-subtitle {
        font-size: 16px;
        color: #aaa;
    }
    
    .modal-close {
        width: 40px;
        height: 40px;
        border: none;
        background: rgba(255,255,255,0.1);
        border-radius: 50%;
        color: #fff;
        font-size: 20px;
        cursor: pointer;
        transition: all 0.2s;
        flex-shrink: 0;
        margin-left: 20px;
    }
    
    .modal-close:hover {
        background: rgba(255,107,107,0.3);
    }
    
    .modal-body {
        padding: 30px;
    }
    
    .modal-section {
        margin-bottom: 25px;
    }
    
    .modal-section:last-child {
        margin-bottom: 0;
    }
    
    .section-title {
        font-size: 14px;
        color: #00d4ff;
        margin-bottom: 12px;
        padding-bottom: 8px;
        border-bottom: 1px solid rgba(0,212,255,0.2);
    }
    
    .key-points-list {
        list-style: none;
    }
    
    .key-points-list li {
        padding: 10px 0;
        padding-left: 20px;
        position: relative;
        border-bottom: 1px solid rgba(255,255,255,0.05);
        color: #ccc;
        line-height: 1.6;
    }
    
    .key-points-list li:last-child {
        border-bottom: none;
    }
    
    .key-points-list li::before {
        content: "â–¸";
        position: absolute;
        left: 0;
        color: #00d4ff;
    }
    
    .stocks-table-wrapper {
        overflow-x: auto;
    }
    
    .stocks-table {
        width: 100%;
        border-collapse: collapse;
        font-size: 13px;
    }
    
    .stocks-table th {
        background: rgba(0,0,0,0.3);
        padding: 10px 12px;
        text-align: left;
        color: #888;
        font-weight: 500;
        white-space: nowrap;
    }
    
    .stocks-table td {
        padding: 10px 12px;
        border-bottom: 1px solid rgba(255,255,255,0.05);
        color: #ccc;
    }
    
    .stocks-table tr:hover td {
        background: rgba(255,255,255,0.03);
    }
    
    .stock-name {
        font-weight: 600;
        color: #fff;
    }
    
    .stock-code {
        color: #888;
        font-size: 11px;
    }
    
    .stock-rating {
        padding: 3px 8px;
        border-radius: 6px;
        font-size: 12px;
        font-weight: 600;
    }
    
    .stock-rating.buy {
        background: rgba(81,207,102,0.2);
        color: #51cf66;
    }
    
    .stock-rating.hold {
        background: rgba(255,193,7,0.2);
        color: #ffc107;
    }
    
    .viewpoint-card {
        background: rgba(0,0,0,0.2);
        border-radius: 12px;
        padding: 20px;
        margin-bottom: 15px;
    }
    
    .viewpoint-title {
        font-size: 15px;
        font-weight: 600;
        color: #fff;
        margin-bottom: 10px;
    }
    
    .viewpoint-content {
        color: #aaa;
        line-height: 1.7;
    }
    
    .picks-row {
        display: flex;
        gap: 15px;
        margin-top: 15px;
        flex-wrap: wrap;
    }
    
    .pick-item {
        background: rgba(0,212,255,0.1);
        border: 1px solid rgba(0,212,255,0.2);
        border-radius: 10px;
        padding: 12px 15px;
        flex: 1;
        min-width: 200px;
    }
    
    .pick-stock {
        font-weight: 600;
        color: #00d4ff;
        margin-bottom: 5px;
    }
    
    .pick-reason {
        font-size: 12px;
        color: #888;
    }
    
    .empty-state {
        text-align: center;
        padding: 60px 20px;
        color: #666;
    }
    
    .empty-state .icon {
        font-size: 48px;
        margin-bottom: 15px;
    }
    
    @media (max-width: 768px) {
        .container { padding: 15px; }
        .header h1 { font-size: 22px; }
        .reports-grid { grid-template-columns: 1fr; }
        .modal-body { padding: 20px; }
        .modal-title { font-size: 20px; }
    }
</style>
```

</head>
<body>
    <!-- è¼‰å…¥ä¸­ç•«é¢ -->
    <div class="loading-overlay" id="loadingOverlay">
        <div class="loading-spinner"></div>
        <div class="loading-text">æ­£åœ¨è¼‰å…¥å ±å‘Šè³‡æ–™...</div>
    </div>

```
<div class="container">
    <div class="header">
        <h1>ğŸ“Š åˆ¸å•†ç ”ç©¶å ±å‘Šè³‡æ–™åº«</h1>
        <p class="subtitle">Rexå¤§å”æŠ•è³‡ç ”ç©¶å®¤</p>
        <div class="update-info">
            <span id="lastUpdate">ğŸ“… è¼‰å…¥ä¸­...</span>
            <span id="reportCount">ğŸ“‘ -- ä»½å ±å‘Š</span>
        </div>
    </div>
    
    <!-- æœå°‹ç¯©é¸å€ -->
    <div class="search-section">
        <div class="search-row">
            <div class="search-input-wrapper">
                <input type="text" id="searchInput" placeholder="æœå°‹å ±å‘Šæ¨™é¡Œã€ç”¢æ¥­ã€åˆ¸å•†ã€å€‹è‚¡ä»£è™Ÿ...">
            </div>
            <div class="filter-select">
                <select id="brokerFilter">
                    <option value="">æ‰€æœ‰åˆ¸å•†</option>
                </select>
            </div>
            <div class="filter-select">
                <select id="ratingFilter">
                    <option value="">æ‰€æœ‰è©•ç­‰</option>
                    <option value="å„ªæ–¼å¤§ç›¤">å„ªæ–¼å¤§ç›¤</option>
                    <option value="æŒå¹³">æŒå¹³</option>
                    <option value="åŠ£æ–¼å¤§ç›¤">åŠ£æ–¼å¤§ç›¤</option>
                </select>
            </div>
        </div>
        <div class="tags-section" id="tagsSection">
            <span class="tags-label">å¿«é€Ÿç¯©é¸ï¼š</span>
            <button class="clear-btn" onclick="clearAll()">æ¸…é™¤å…¨éƒ¨</button>
        </div>
    </div>
    
    <div class="stats-bar">
        <div class="stats-text">
            å…± <strong id="totalCount">0</strong> ä»½å ±å‘Šï¼Œ
            ç¯©é¸çµæœ <strong id="filteredCount">0</strong> ä»½
        </div>
    </div>
    
    <div class="reports-grid" id="reportsGrid"></div>
</div>

<!-- è©³ç´°å…§å®¹å½ˆçª— -->
<div class="modal-overlay" id="modalOverlay" onclick="closeModal(event)">
    <div class="modal-content" onclick="event.stopPropagation()">
        <div class="modal-header">
            <div class="modal-header-info">
                <div class="modal-broker-date">
                    <span class="modal-broker" id="modalBroker"></span>
                    <span class="modal-date" id="modalDate"></span>
                    <span id="modalIndustry" style="color:#7b68ee;"></span>
                </div>
                <h2 class="modal-title" id="modalTitle"></h2>
                <p class="modal-subtitle" id="modalSubtitle"></p>
            </div>
            <button class="modal-close" onclick="closeModal()">&times;</button>
        </div>
        <div class="modal-body" id="modalBody"></div>
    </div>
</div>

<script>
    // ========== è¨­å®šå€ ==========
    // Excel æª”æ¡ˆåç¨±ï¼ˆèˆ‡ index.html æ”¾åœ¨åŒä¸€ç›®éŒ„ï¼‰
    const EXCEL_FILE = 'æŠ•è³‡å±•æœ›å ±å‘Šæ”¶é›†æ¨¡æ¿_æ›´æ–°ç‰ˆ.xlsx';
    // ============================
    
    let allReports = [];
    let reportDetails = {};
    let stocksData = {};
    let viewpointsData = {};
    let activeTag = null;
    
    // é é¢è¼‰å…¥æ™‚è‡ªå‹•è®€å– Excel
    window.onload = function() {
        loadExcelData();
    };
    
    async function loadExcelData() {
        try {
            const response = await fetch(EXCEL_FILE);
            if (!response.ok) {
                throw new Error(`æ‰¾ä¸åˆ°æª”æ¡ˆï¼š${EXCEL_FILE}`);
            }
            
            const arrayBuffer = await response.arrayBuffer();
            const workbook = XLSX.read(arrayBuffer, { type: 'array' });
            
            parseWorkbook(workbook);
            buildFilters();
            renderReports(allReports);
            
            document.getElementById('lastUpdate').textContent = `ğŸ“… ${new Date().toLocaleDateString('zh-TW')}`;
            document.getElementById('reportCount').textContent = `ğŸ“‘ ${allReports.length} ä»½å ±å‘Š`;
            document.getElementById('loadingOverlay').classList.add('hidden');
            
        } catch (error) {
            console.error('è¼‰å…¥å¤±æ•—:', error);
            document.getElementById('loadingOverlay').innerHTML = `
                <div class="error-message">
                    <h2>âŒ è¼‰å…¥å¤±æ•—</h2>
                    <p>${error.message}</p>
                    <p style="color:#888;margin-top:10px;">è«‹ç¢ºèª ${EXCEL_FILE} æª”æ¡ˆå­˜åœ¨æ–¼åŒä¸€ç›®éŒ„</p>
                    <button class="retry-btn" onclick="location.reload()">é‡æ–°è¼‰å…¥</button>
                </div>
            `;
        }
    }
    
    function parseWorkbook(workbook) {
        allReports = [];
        reportDetails = {};
        stocksData = {};
        viewpointsData = {};
        
        // è§£æå ±å‘Šç¸½è¦½
        const overviewSheet = workbook.Sheets['å ±å‘Šç¸½è¦½'];
        if (overviewSheet) {
            const data = XLSX.utils.sheet_to_json(overviewSheet);
            data.forEach(row => {
                if (!row['å ±å‘Šç·¨è™Ÿ']) return;
                
                const report = {
                    id: row['å ±å‘Šç·¨è™Ÿ'],
                    broker: row['åˆ¸å•†åç¨±'] || '',
                    date: formatDate(row['å ±å‘Šæ—¥æœŸ']),
                    type: row['å ±å‘Šé¡å‹'] || '',
                    market: row['å¸‚å ´åˆ¥'] || '',
                    industry: row['ç”¢æ¥­åç¨±'] || '',
                    title: row['å ±å‘Šæ¨™é¡Œ'] || '',
                    subtitle: row['å‰¯æ¨™é¡Œ'] || '',
                    rating: row['ç”¢æ¥­è©•ç­‰'] || '',
                    analyst: row['åˆ†æå¸«å§“å'] || '',
                    phone: row['åˆ†æå¸«é›»è©±'] || '',
                    email: row['åˆ†æå¸«Email'] || '',
                    highlights: []
                };
                
                for (let i = 1; i <= 5; i++) {
                    if (row[`æ ¸å¿ƒé‡é»${i}`]) {
                        report.highlights.push(row[`æ ¸å¿ƒé‡é»${i}`]);
                    }
                }
                
                allReports.push(report);
            });
        }
        
        // è§£æç„¦é»åˆ†æå…§å®¹
        const detailSheet = workbook.Sheets['ç„¦é»åˆ†æå…§å®¹'];
        if (detailSheet) {
            const data = XLSX.utils.sheet_to_json(detailSheet);
            data.forEach(row => {
                if (!row['å ±å‘Šç·¨è™Ÿ']) return;
                const id = row['å ±å‘Šç·¨è™Ÿ'];
                if (!reportDetails[id]) reportDetails[id] = [];
                reportDetails[id].push({
                    sectionNo: row['æ®µè½ç·¨è™Ÿ'],
                    sectionTitle: row['æ®µè½æ¨™é¡Œ'] || '',
                    content: row['æ®µè½å…§å®¹'] || '',
                    marketSize: row['å¸‚å ´è¦æ¨¡æ•¸æ“š'] || '',
                    growthRate: row['æˆé•·ç‡æ•¸æ“š'] || '',
                    source: row['è³‡æ–™ä¾†æº'] || ''
                });
            });
        }
        
        // è§£æå€‹è‚¡è©•åƒ¹è¡¨
        const stocksSheet = workbook.Sheets['å€‹è‚¡è©•åƒ¹è¡¨'];
        if (stocksSheet) {
            const data = XLSX.utils.sheet_to_json(stocksSheet);
            data.forEach(row => {
                if (!row['å ±å‘Šç·¨è™Ÿ']) return;
                const id = row['å ±å‘Šç·¨è™Ÿ'];
                if (!stocksData[id]) stocksData[id] = [];
                stocksData[id].push({
                    name: row['å…¬å¸åç¨±'] || '',
                    code: row['è‚¡ç¥¨ä»£è™Ÿ'] || '',
                    rating: row['è©•ç­‰'] || '',
                    price: row['æ”¶ç›¤åƒ¹'],
                    target: row['ç›®æ¨™åƒ¹'],
                    eps25: row['EPS_FY25F'],
                    eps26: row['EPS_FY26F'],
                    pe25: row['PE_FY25F'],
                    pe26: row['PE_FY26F'],
                    product: row['ä¸»è¦ç”¢å“'] || '',
                    market: row['çµ‚ç«¯æ‡‰ç”¨å¸‚å ´'] || '',
                    highlight: row['æŠ•è³‡äº®é»'] || ''
                });
            });
        }
        
        // è§£æåˆ¸å•†è§€é»çµè«–
        const viewpointSheet = workbook.Sheets['åˆ¸å•†è§€é»çµè«–'];
        if (viewpointSheet) {
            const data = XLSX.utils.sheet_to_json(viewpointSheet);
            data.forEach(row => {
                if (!row['å ±å‘Šç·¨è™Ÿ']) return;
                const id = row['å ±å‘Šç·¨è™Ÿ'];
                if (!viewpointsData[id]) viewpointsData[id] = [];
                
                const picks = [];
                for (let i = 1; i <= 3; i++) {
                    if (row[`é¦–é¸å€‹è‚¡${i}`]) {
                        picks.push({
                            stock: row[`é¦–é¸å€‹è‚¡${i}`],
                            reason: row[`é¦–é¸ç†ç”±${i}`] || ''
                        });
                    }
                }
                
                viewpointsData[id].push({
                    type: row['è§€é»é¡å‹'] || '',
                    title: row['è§€é»æ¨™é¡Œ'] || '',
                    content: row['è§€é»å…§å®¹'] || '',
                    picks: picks,
                    risk: row['é¢¨éšªæé†’'] || ''
                });
            });
        }
    }
    
    function formatDate(dateValue) {
        if (!dateValue) return '';
        if (typeof dateValue === 'string') return dateValue;
        if (typeof dateValue === 'number') {
            const date = new Date((dateValue - 25569) * 86400 * 1000);
            return date.toLocaleDateString('zh-TW');
        }
        return String(dateValue);
    }
    
    function buildFilters() {
        // åˆ¸å•†é¸é …
        const brokers = [...new Set(allReports.map(r => r.broker).filter(Boolean))];
        const brokerSelect = document.getElementById('brokerFilter');
        brokerSelect.innerHTML = '<option value="">æ‰€æœ‰åˆ¸å•†</option>';
        brokers.forEach(b => {
            brokerSelect.innerHTML += `<option value="${b}">${b}</option>`;
        });
        
        // ç”¢æ¥­æ¨™ç±¤
        const industries = [...new Set(allReports.map(r => r.industry).filter(Boolean))];
        const tagsSection = document.getElementById('tagsSection');
        const clearBtn = tagsSection.querySelector('.clear-btn');
        
        industries.forEach(ind => {
            const tag = document.createElement('span');
            tag.className = 'tag';
            tag.textContent = ind;
            tag.onclick = () => toggleTag(ind, tag);
            tagsSection.insertBefore(tag, clearBtn);
        });
        
        document.getElementById('searchInput').oninput = applyFilters;
        document.getElementById('brokerFilter').onchange = applyFilters;
        document.getElementById('ratingFilter').onchange = applyFilters;
    }
    
    function toggleTag(industry, tagElement) {
        const allTags = document.querySelectorAll('.tag');
        
        if (activeTag === industry) {
            activeTag = null;
            tagElement.classList.remove('active');
        } else {
            activeTag = industry;
            allTags.forEach(t => t.classList.remove('active'));
            tagElement.classList.add('active');
        }
        
        applyFilters();
    }
    
    function clearAll() {
        document.getElementById('searchInput').value = '';
        document.getElementById('brokerFilter').value = '';
        document.getElementById('ratingFilter').value = '';
        activeTag = null;
        document.querySelectorAll('.tag').forEach(t => t.classList.remove('active'));
        renderReports(allReports);
    }
    
    function applyFilters() {
        const keyword = document.getElementById('searchInput').value.toLowerCase().trim();
        const broker = document.getElementById('brokerFilter').value;
        const rating = document.getElementById('ratingFilter').value;
        
        const filtered = allReports.filter(report => {
            if (keyword) {
                const searchText = [
                    report.title,
                    report.subtitle,
                    report.broker,
                    report.industry,
                    report.highlights.join(' '),
                    (stocksData[report.id] || []).map(s => `${s.name} ${s.code}`).join(' ')
                ].join(' ').toLowerCase();
                
                if (!searchText.includes(keyword)) return false;
            }
            
            if (broker && report.broker !== broker) return false;
            if (rating && report.rating !== rating) return false;
            if (activeTag && report.industry !== activeTag) return false;
            
            return true;
        });
        
        renderReports(filtered);
    }
    
    function renderReports(reports) {
        const grid = document.getElementById('reportsGrid');
        document.getElementById('totalCount').textContent = allReports.length;
        document.getElementById('filteredCount').textContent = reports.length;
        
        if (reports.length === 0) {
            grid.innerHTML = `
                <div class="empty-state">
                    <div class="icon">ğŸ”</div>
                    <p>æ²’æœ‰ç¬¦åˆæ¢ä»¶çš„å ±å‘Š</p>
                </div>
            `;
            return;
        }
        
        grid.innerHTML = reports.map(report => {
            const stocks = stocksData[report.id] || [];
            const ratingClass = report.rating.includes('å„ªæ–¼') ? 'positive' : 'neutral';
            
            return `
                <div class="report-card" onclick="openModal('${report.id}')">
                    <div class="card-header">
                        <span class="card-broker">${report.broker}</span>
                        <span class="card-date">${report.date}</span>
                    </div>
                    <h3 class="card-title">${report.title}</h3>
                    <p class="card-subtitle">${report.subtitle || ''}</p>
                    <span class="card-industry">${report.industry}</span>
                    ${report.rating ? `
                        <div class="card-rating">
                            <span class="rating-label">ç”¢æ¥­è©•ç­‰ï¼š</span>
                            <span class="rating-value ${ratingClass}">${report.rating}</span>
                        </div>
                    ` : ''}
                    <div class="card-highlights">
                        ${report.highlights.slice(0, 3).map(h => `
                            <div class="highlight-item">${truncate(h, 50)}</div>
                        `).join('')}
                    </div>
                    ${stocks.length > 0 ? `
                        <div class="card-stocks">
                            ${stocks.slice(0, 5).map(s => `
                                <span class="stock-tag">${s.name}</span>
                            `).join('')}
                            ${stocks.length > 5 ? `<span class="stock-tag">+${stocks.length - 5}</span>` : ''}
                        </div>
                    ` : ''}
                </div>
            `;
        }).join('');
    }
    
    function truncate(text, maxLength) {
        if (!text) return '';
        return text.length > maxLength ? text.substring(0, maxLength) + '...' : text;
    }
    
    function openModal(reportId) {
        const report = allReports.find(r => r.id === reportId);
        if (!report) return;
        
        document.getElementById('modalBroker').textContent = report.broker;
        document.getElementById('modalDate').textContent = report.date;
        document.getElementById('modalIndustry').textContent = report.industry;
        document.getElementById('modalTitle').textContent = report.title;
        document.getElementById('modalSubtitle').textContent = report.subtitle || '';
        
        const details = reportDetails[reportId] || [];
        const stocks = stocksData[reportId] || [];
        const viewpoints = viewpointsData[reportId] || [];
        
        let bodyHTML = '';
        
        // æ ¸å¿ƒé‡é»
        if (report.highlights.length > 0) {
            bodyHTML += `
                <div class="modal-section">
                    <h3 class="section-title">ğŸ“Œ æ ¸å¿ƒé‡é»</h3>
                    <ul class="key-points-list">
                        ${report.highlights.map(h => `<li>${h}</li>`).join('')}
                    </ul>
                </div>
            `;
        }
        
        // ç„¦é»åˆ†æ
        if (details.length > 0) {
            bodyHTML += `
                <div class="modal-section">
                    <h3 class="section-title">ğŸ“Š ç„¦é»åˆ†æ</h3>
                    ${details.map(d => `
                        <div class="viewpoint-card">
                            <div class="viewpoint-title">${d.sectionTitle}</div>
                            <div class="viewpoint-content">${d.content}</div>
                            ${d.marketSize ? `<div style="margin-top:10px;color:#00d4ff;font-size:13px;">ğŸ“ˆ ${d.marketSize}</div>` : ''}
                            ${d.growthRate ? `<div style="color:#51cf66;font-size:13px;">ğŸ“Š ${d.growthRate}</div>` : ''}
                        </div>
                    `).join('')}
                </div>
            `;
        }
        
        // å€‹è‚¡è©•åƒ¹
        if (stocks.length > 0) {
            bodyHTML += `
                <div class="modal-section">
                    <h3 class="section-title">ğŸ“ˆ å€‹è‚¡è©•åƒ¹</h3>
                    <div class="stocks-table-wrapper">
                        <table class="stocks-table">
                            <thead>
                                <tr>
                                    <th>å…¬å¸</th>
                                    <th>è©•ç­‰</th>
                                    <th>æ”¶ç›¤åƒ¹</th>
                                    <th>ç›®æ¨™åƒ¹</th>
                                    <th>25F EPS</th>
                                    <th>26F EPS</th>
                                    <th>æŠ•è³‡äº®é»</th>
                                </tr>
                            </thead>
                            <tbody>
                                ${stocks.map(s => {
                                    const ratingClass = s.rating === 'è²·é€²' ? 'buy' : (s.rating === 'æŒæœ‰' ? 'hold' : '');
                                    return `
                                        <tr>
                                            <td>
                                                <div class="stock-name">${s.name}</div>
                                                <div class="stock-code">${s.code}</div>
                                            </td>
                                            <td><span class="stock-rating ${ratingClass}">${s.rating}</span></td>
                                            <td>${s.price || '-'}</td>
                                            <td>${s.target || '-'}</td>
                                            <td>${s.eps25 || '-'}</td>
                                            <td>${s.eps26 || '-'}</td>
                                            <td>${s.highlight || '-'}</td>
                                        </tr>
                                    `;
                                }).join('')}
                            </tbody>
                        </table>
                    </div>
                </div>
            `;
        }
        
        // åˆ¸å•†è§€é»
        if (viewpoints.length > 0) {
            bodyHTML += `
                <div class="modal-section">
                    <h3 class="section-title">ğŸ’¡ åˆ¸å•†è§€é»</h3>
                    ${viewpoints.map(v => `
                        <div class="viewpoint-card">
                            <div class="viewpoint-title">${v.title || v.type}</div>
                            <div class="viewpoint-content">${v.content}</div>
                            ${v.picks.length > 0 ? `
                                <div class="picks-row">
                                    ${v.picks.map(p => `
                                        <div class="pick-item">
                                            <div class="pick-stock">â­ ${p.stock}</div>
                                            <div class="pick-reason">${p.reason}</div>
                                        </div>
                                    `).join('')}
                                </div>
                            ` : ''}
                            ${v.risk ? `
                                <div style="margin-top:15px;padding:10px;background:rgba(255,107,107,0.1);border-radius:8px;color:#ff6b6b;font-size:13px;">
                                    âš ï¸ é¢¨éšªæé†’ï¼š${v.risk}
                                </div>
                            ` : ''}
                        </div>
                    `).join('')}
                </div>
            `;
        }
        
        // åˆ†æå¸«è³‡è¨Š
        if (report.analyst) {
            bodyHTML += `
                <div class="modal-section">
                    <h3 class="section-title">ğŸ‘¤ åˆ†æå¸«</h3>
                    <div style="color:#ccc;">
                        ${report.analyst}
                        ${report.phone ? ` ï½œ ğŸ“ ${report.phone}` : ''}
                        ${report.email ? ` ï½œ ğŸ“§ ${report.email}` : ''}
                    </div>
                </div>
            `;
        }
        
        document.getElementById('modalBody').innerHTML = bodyHTML;
        document.getElementById('modalOverlay').classList.add('active');
        document.body.style.overflow = 'hidden';
    }
    
    function closeModal(event) {
        if (event && event.target !== document.getElementById('modalOverlay')) return;
        document.getElementById('modalOverlay').classList.remove('active');
        document.body.style.overflow = '';
    }
    
    document.addEventListener('keydown', (e) => {
        if (e.key === 'Escape') closeModal();
    });
</script>
```

</body>
</html>