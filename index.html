<!DOCTYPE html>

<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Rexå¤§å”æŠ•è³‡ç ”ç©¶å®¤</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }

```
    body {
        font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Microsoft JhengHei", sans-serif;
        background: #f5f4ef;
        min-height: 100vh;
        color: #2d2d2d;
    }
    
    .container {
        max-width: 1200px;
        margin: 0 auto;
        padding: 12px;
    }
    
    /* é ‚éƒ¨æ¨™é¡Œ */
    .header {
        text-align: center;
        padding: 20px 0 15px;
        border-bottom: 1px solid #e5e3dc;
        margin-bottom: 15px;
    }
    
    .header h1 {
        font-size: 22px;
        color: #c96442;
        margin-bottom: 4px;
    }
    
    .header .subtitle {
        color: #6b6b6b;
        font-size: 13px;
    }
    
    /* è³‡æ–™åº«åˆ‡æ› */
    .db-switcher {
        display: flex;
        justify-content: center;
        gap: 8px;
        margin: 15px 0;
    }
    
    .db-tab {
        padding: 10px 24px;
        border: 2px solid #e5e3dc;
        background: #fff;
        border-radius: 25px;
        font-size: 14px;
        font-weight: 600;
        color: #6b6b6b;
        cursor: pointer;
        transition: all 0.2s;
    }
    
    .db-tab:hover {
        border-color: #c96442;
        color: #c96442;
    }
    
    .db-tab.active {
        background: #c96442;
        border-color: #c96442;
        color: #fff;
    }
    
    .db-tab .count {
        display: inline-block;
        background: rgba(255,255,255,0.3);
        padding: 2px 8px;
        border-radius: 10px;
        font-size: 12px;
        margin-left: 6px;
    }
    
    .db-tab.active .count {
        background: rgba(255,255,255,0.3);
    }
    
    /* è¼‰å…¥ç‹€æ…‹ */
    .loading-overlay {
        position: fixed;
        top: 0; left: 0; right: 0; bottom: 0;
        background: #f5f4ef;
        display: flex;
        flex-direction: column;
        justify-content: center;
        align-items: center;
        z-index: 9999;
    }
    
    .loading-overlay.hidden { display: none; }
    
    .loading-spinner {
        width: 40px; height: 40px;
        border: 3px solid #e5e3dc;
        border-top-color: #c96442;
        border-radius: 50%;
        animation: spin 1s linear infinite;
        margin-bottom: 15px;
    }
    
    @keyframes spin { to { transform: rotate(360deg); } }
    
    .loading-text { color: #6b6b6b; font-size: 14px; }
    
    /* æœå°‹å€ */
    .search-section {
        background: #fff;
        border: 1px solid #e5e3dc;
        border-radius: 16px;
        padding: 16px;
        margin-bottom: 15px;
        box-shadow: 0 2px 8px rgba(0,0,0,0.04);
    }
    
    /* ä¸»æœå°‹æ¡† */
    .main-search {
        position: relative;
        margin-bottom: 12px;
    }
    
    .main-search::before {
        content: "ğŸ”";
        position: absolute;
        left: 16px;
        top: 50%;
        transform: translateY(-50%);
        font-size: 16px;
        z-index: 2;
    }
    
    #mainSearchInput {
        width: 100%;
        padding: 14px 14px 14px 48px;
        border: 2px solid #e5e3dc;
        border-radius: 30px;
        background: #fafaf8;
        color: #2d2d2d;
        font-size: 16px;
        transition: all 0.2s;
    }
    
    #mainSearchInput:focus {
        outline: none;
        border-color: #c96442;
        background: #fff;
        box-shadow: 0 0 0 3px rgba(201,100,66,0.1);
    }
    
    #mainSearchInput::placeholder { color: #9a9a9a; }
    
    /* æœå°‹å»ºè­°ä¸‹æ‹‰ */
    .search-suggestions {
        position: absolute;
        top: 100%;
        left: 0;
        right: 0;
        background: #fff;
        border: 1px solid #e5e3dc;
        border-radius: 12px;
        margin-top: 4px;
        max-height: 300px;
        overflow-y: auto;
        z-index: 100;
        display: none;
        box-shadow: 0 4px 20px rgba(0,0,0,0.1);
    }
    
    .search-suggestions.active { display: block; }
    
    .suggestion-group {
        padding: 8px 0;
        border-bottom: 1px solid #f0eeea;
    }
    
    .suggestion-group:last-child { border-bottom: none; }
    
    .suggestion-group-title {
        padding: 4px 14px;
        font-size: 11px;
        color: #8b8b8b;
        text-transform: uppercase;
        letter-spacing: 0.5px;
    }
    
    .suggestion-item {
        padding: 10px 14px;
        cursor: pointer;
        display: flex;
        align-items: center;
        gap: 10px;
    }
    
    .suggestion-item:hover {
        background: #fafaf8;
    }
    
    .suggestion-icon {
        width: 28px;
        height: 28px;
        border-radius: 6px;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 14px;
        flex-shrink: 0;
    }
    
    .suggestion-icon.company { background: #e8f5ec; }
    .suggestion-icon.tag { background: #fff3e6; }
    .suggestion-icon.broker { background: #e6f0ff; }
    .suggestion-icon.category { background: #f3e6ff; }
    
    .suggestion-text {
        flex: 1;
    }
    
    .suggestion-main {
        font-size: 14px;
        color: #2d2d2d;
    }
    
    .suggestion-sub {
        font-size: 12px;
        color: #8b8b8b;
    }
    
    .suggestion-count {
        font-size: 12px;
        color: #8b8b8b;
        background: #f0eeea;
        padding: 2px 8px;
        border-radius: 10px;
    }
    
    /* ç†±é–€æœå°‹æ¨™ç±¤ */
    .hot-tags {
        margin-bottom: 12px;
    }
    
    .hot-tags-header {
        display: flex;
        align-items: center;
        gap: 8px;
        margin-bottom: 8px;
    }
    
    .hot-tags-title {
        font-size: 12px;
        color: #8b8b8b;
    }
    
    .hot-tags-list {
        display: flex;
        flex-wrap: wrap;
        gap: 6px;
    }
    
    .hot-tag {
        padding: 6px 12px;
        background: linear-gradient(135deg, #fff3e6 0%, #ffe6cc 100%);
        border: none;
        border-radius: 15px;
        font-size: 13px;
        color: #c96442;
        cursor: pointer;
        transition: all 0.2s;
    }
    
    .hot-tag:hover {
        transform: translateY(-1px);
        box-shadow: 0 2px 8px rgba(201,100,66,0.2);
    }
    
    .hot-tag.active {
        background: #c96442;
        color: #fff;
    }
    
    /* ç¯©é¸åˆ— */
    .filter-row {
        display: flex;
        gap: 10px;
        flex-wrap: wrap;
        align-items: center;
    }
    
    .filter-select {
        flex: 1;
        min-width: 120px;
    }
    
    .filter-select select {
        width: 100%;
        padding: 10px 12px;
        border: 1px solid #e5e3dc;
        border-radius: 20px;
        background: #fafaf8;
        color: #2d2d2d;
        font-size: 13px;
        cursor: pointer;
        appearance: none;
        background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='12' height='12' fill='%236b6b6b' viewBox='0 0 16 16'%3E%3Cpath d='M8 11L3 6h10l-5 5z'/%3E%3C/svg%3E");
        background-repeat: no-repeat;
        background-position: right 12px center;
    }
    
    .filter-select select:focus {
        outline: none;
        border-color: #c96442;
    }
    
    .clear-all-btn {
        padding: 10px 16px;
        background: transparent;
        border: 1px solid #d64545;
        border-radius: 20px;
        font-size: 13px;
        color: #d64545;
        cursor: pointer;
        white-space: nowrap;
    }
    
    .clear-all-btn:hover {
        background: rgba(214,69,69,0.08);
    }
    
    /* å·²é¸æ“‡çš„ç¯©é¸æ¢ä»¶ */
    .active-filters {
        display: flex;
        flex-wrap: wrap;
        gap: 6px;
        margin-top: 10px;
    }
    
    .active-filter {
        display: inline-flex;
        align-items: center;
        gap: 6px;
        padding: 5px 10px;
        background: #c96442;
        color: #fff;
        border-radius: 15px;
        font-size: 12px;
    }
    
    .active-filter .remove {
        cursor: pointer;
        opacity: 0.8;
    }
    
    .active-filter .remove:hover {
        opacity: 1;
    }
    
    /* çµ±è¨ˆåˆ— */
    .stats-bar {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 8px 0;
        margin-bottom: 12px;
        font-size: 13px;
        color: #6b6b6b;
    }
    
    .stats-bar strong { color: #c96442; }
    
    .sort-options {
        display: flex;
        gap: 8px;
    }
    
    .sort-btn {
        padding: 5px 12px;
        background: #eceae3;
        border: none;
        border-radius: 12px;
        font-size: 12px;
        color: #5a5a5a;
        cursor: pointer;
    }
    
    .sort-btn.active {
        background: #c96442;
        color: #fff;
    }
    
    /* å ±å‘Šåˆ—è¡¨ */
    .reports-list {
        display: flex;
        flex-direction: column;
        gap: 10px;
    }
    
    /* å¤–é›»å¿«å ±å¡ç‰‡ */
    .news-card {
        background: #fff;
        border: 1px solid #e5e3dc;
        border-radius: 14px;
        padding: 14px;
        cursor: pointer;
        transition: all 0.2s;
        box-shadow: 0 2px 8px rgba(0,0,0,0.04);
    }
    
    .news-card:hover {
        border-color: #c96442;
        box-shadow: 0 4px 16px rgba(201,100,66,0.12);
    }
    
    .news-card-header {
        display: flex;
        justify-content: space-between;
        align-items: flex-start;
        margin-bottom: 8px;
    }
    
    .news-card-left {
        display: flex;
        align-items: center;
        gap: 10px;
        flex: 1;
    }
    
    .company-badge {
        font-size: 15px;
        font-weight: 700;
        color: #2d2d2d;
    }
    
    .stock-code {
        font-size: 12px;
        color: #8b8b8b;
        background: #f0eeea;
        padding: 2px 8px;
        border-radius: 8px;
    }
    
    .importance-stars {
        color: #f5a623;
        font-size: 12px;
        letter-spacing: -2px;
    }
    
    .news-card-meta {
        display: flex;
        align-items: center;
        gap: 8px;
        flex-wrap: wrap;
    }
    
    .broker-tag {
        font-size: 11px;
        padding: 3px 8px;
        background: #c96442;
        color: #fff;
        border-radius: 10px;
        font-weight: 500;
    }
    
    .category-tag {
        font-size: 11px;
        padding: 3px 8px;
        background: #5a9e6f;
        color: #fff;
        border-radius: 10px;
    }
    
    .date-tag {
        font-size: 11px;
        color: #8b8b8b;
    }
    
    .news-card-content {
        font-size: 14px;
        color: #5a5a5a;
        line-height: 1.6;
        margin-bottom: 10px;
        display: -webkit-box;
        -webkit-line-clamp: 3;
        -webkit-box-orient: vertical;
        overflow: hidden;
    }
    
    .news-card-tags {
        display: flex;
        flex-wrap: wrap;
        gap: 5px;
    }
    
    .mini-tag {
        font-size: 11px;
        padding: 3px 8px;
        background: #fff3e6;
        color: #c96442;
        border-radius: 8px;
    }
    
    /* ç”¢æ¥­å±•æœ›å¡ç‰‡ */
    .report-card {
        background: #fff;
        border: 1px solid #e5e3dc;
        border-radius: 14px;
        padding: 14px;
        cursor: pointer;
        transition: all 0.2s;
        box-shadow: 0 2px 8px rgba(0,0,0,0.04);
    }
    
    .report-card:hover {
        border-color: #c96442;
        box-shadow: 0 4px 16px rgba(201,100,66,0.12);
    }
    
    .card-top {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 8px;
    }
    
    .card-meta {
        display: flex;
        align-items: center;
        gap: 8px;
    }
    
    .card-broker {
        font-size: 12px;
        color: #fff;
        font-weight: 600;
        background: #c96442;
        padding: 3px 10px;
        border-radius: 10px;
    }
    
    .card-date {
        font-size: 12px;
        color: #8b8b8b;
    }
    
    .card-industry {
        font-size: 11px;
        color: #fff;
        padding: 3px 10px;
        background: #5a9e6f;
        border-radius: 10px;
        font-weight: 500;
    }
    
    .card-title {
        font-size: 16px;
        font-weight: 700;
        color: #2d2d2d;
        margin-bottom: 3px;
        line-height: 1.4;
    }
    
    .card-subtitle {
        font-size: 13px;
        color: #6b6b6b;
        margin-bottom: 8px;
    }
    
    .card-rating {
        display: inline-flex;
        align-items: center;
        gap: 6px;
        margin-bottom: 10px;
    }
    
    .rating-label {
        font-size: 11px;
        color: #8b8b8b;
    }
    
    .rating-value {
        font-size: 11px;
        font-weight: 600;
        padding: 3px 10px;
        border-radius: 10px;
    }
    
    .rating-value.positive { background: #e8f5ec; color: #2e7d46; }
    .rating-value.neutral { background: #fff8e6; color: #b8860b; }
    .rating-value.negative { background: #fef2f2; color: #d64545; }
    
    .card-highlights {
        border-top: 1px solid #eceae3;
        padding-top: 8px;
    }
    
    .highlight-item {
        font-size: 13px;
        color: #5a5a5a;
        padding: 2px 0 2px 14px;
        position: relative;
        line-height: 1.5;
    }
    
    .highlight-item::before {
        content: "â€¢";
        position: absolute;
        left: 0;
        color: #c96442;
    }
    
    .card-stocks {
        display: flex;
        flex-wrap: wrap;
        gap: 5px;
        margin-top: 8px;
    }
    
    .stock-tag {
        font-size: 11px;
        padding: 3px 8px;
        background: #eceae3;
        border-radius: 8px;
        color: #5a5a5a;
    }
    
    /* ç”¢æ¥­è¶¨å‹¢å¡ç‰‡ */
    .trend-card {
        background: linear-gradient(135deg, #fff 0%, #fafaf8 100%);
        border: 2px solid #5a9e6f;
        border-radius: 14px;
        padding: 14px;
        cursor: pointer;
        transition: all 0.2s;
    }
    
    .trend-card:hover {
        box-shadow: 0 4px 16px rgba(90,158,111,0.2);
    }
    
    .trend-badge {
        display: inline-block;
        font-size: 10px;
        padding: 2px 8px;
        background: #5a9e6f;
        color: #fff;
        border-radius: 8px;
        margin-bottom: 6px;
    }
    
    .trend-title {
        font-size: 16px;
        font-weight: 700;
        color: #2d2d2d;
        margin-bottom: 6px;
    }
    
    .trend-companies {
        font-size: 12px;
        color: #5a9e6f;
        margin-bottom: 8px;
    }
    
    .trend-content {
        font-size: 13px;
        color: #5a5a5a;
        line-height: 1.6;
        display: -webkit-box;
        -webkit-line-clamp: 2;
        -webkit-box-orient: vertical;
        overflow: hidden;
    }
    
    /* å½ˆçª— */
    .modal-overlay {
        position: fixed;
        top: 0; left: 0; right: 0; bottom: 0;
        background: rgba(0,0,0,0.5);
        z-index: 1000;
        display: none;
        overflow-y: auto;
        padding: 20px 12px;
    }
    
    .modal-overlay.active { display: block; }
    
    .modal-content {
        max-width: 800px;
        margin: 0 auto;
        background: #fff;
        border-radius: 20px;
        overflow: hidden;
        box-shadow: 0 10px 40px rgba(0,0,0,0.15);
    }
    
    .modal-header {
        padding: 18px;
        background: #fafaf8;
        border-bottom: 1px solid #e5e3dc;
        display: flex;
        justify-content: space-between;
        align-items: flex-start;
    }
    
    .modal-header-info { flex: 1; }
    
    .modal-meta {
        display: flex;
        flex-wrap: wrap;
        gap: 8px;
        margin-bottom: 8px;
    }
    
    .modal-meta-item {
        font-size: 12px;
        padding: 3px 10px;
        border-radius: 10px;
    }
    
    .modal-meta-item.broker { background: #c96442; color: #fff; }
    .modal-meta-item.date { background: #eceae3; color: #5a5a5a; }
    .modal-meta-item.category { background: #5a9e6f; color: #fff; }
    .modal-meta-item.importance { background: #fff3e6; color: #c96442; }
    
    .modal-title {
        font-size: 20px;
        font-weight: 700;
        color: #2d2d2d;
        margin-bottom: 4px;
    }
    
    .modal-subtitle {
        font-size: 14px;
        color: #6b6b6b;
    }
    
    .modal-close {
        width: 36px; height: 36px;
        border: none;
        background: #eceae3;
        border-radius: 50%;
        color: #5a5a5a;
        font-size: 20px;
        cursor: pointer;
        flex-shrink: 0;
        margin-left: 12px;
    }
    
    .modal-close:hover { background: #e0ded6; }
    
    .modal-body { padding: 18px; }
    
    .modal-section { margin-bottom: 20px; }
    .modal-section:last-child { margin-bottom: 0; }
    
    .section-title {
        font-size: 14px;
        font-weight: 600;
        color: #c96442;
        margin-bottom: 10px;
        padding-bottom: 6px;
        border-bottom: 1px solid #eceae3;
        display: flex;
        align-items: center;
        gap: 6px;
    }
    
    .content-block {
        background: #fafaf8;
        border-radius: 12px;
        padding: 14px;
        font-size: 14px;
        color: #2d2d2d;
        line-height: 1.8;
        white-space: pre-wrap;
    }
    
    .tags-block {
        display: flex;
        flex-wrap: wrap;
        gap: 6px;
    }
    
    .modal-tag {
        font-size: 13px;
        padding: 5px 12px;
        background: #fff3e6;
        color: #c96442;
        border-radius: 15px;
        cursor: pointer;
    }
    
    .modal-tag:hover {
        background: #c96442;
        color: #fff;
    }
    
    .companies-block {
        display: flex;
        flex-wrap: wrap;
        gap: 8px;
    }
    
    .company-chip {
        display: flex;
        align-items: center;
        gap: 6px;
        padding: 8px 12px;
        background: #e8f5ec;
        border-radius: 20px;
        font-size: 13px;
        color: #2e7d46;
        cursor: pointer;
    }
    
    .company-chip:hover {
        background: #5a9e6f;
        color: #fff;
    }
    
    /* è¡¨æ ¼ */
    .stocks-table-wrapper { overflow-x: auto; margin-top: 10px; }
    
    .stocks-table {
        width: 100%;
        border-collapse: collapse;
        font-size: 12px;
    }
    
    .stocks-table th {
        background: #fafaf8;
        padding: 8px;
        text-align: left;
        color: #6b6b6b;
        font-weight: 500;
        white-space: nowrap;
        border-bottom: 1px solid #e5e3dc;
    }
    
    .stocks-table td {
        padding: 8px;
        border-bottom: 1px solid #f0eeea;
        color: #2d2d2d;
    }
    
    .stock-name-cell { font-weight: 600; }
    .stock-code-cell { color: #8b8b8b; font-size: 11px; }
    
    .stock-rating-badge {
        padding: 2px 8px;
        border-radius: 8px;
        font-size: 11px;
        font-weight: 600;
    }
    
    .stock-rating-badge.buy { background: #e8f5ec; color: #2e7d46; }
    .stock-rating-badge.hold { background: #fff8e6; color: #b8860b; }
    
    /* è§€é»å¡ç‰‡ */
    .viewpoint-card {
        background: #fafaf8;
        border-radius: 12px;
        padding: 14px;
        margin-bottom: 10px;
    }
    
    .viewpoint-title {
        font-size: 14px;
        font-weight: 600;
        color: #2d2d2d;
        margin-bottom: 6px;
    }
    
    .viewpoint-content {
        color: #5a5a5a;
        line-height: 1.7;
        font-size: 13px;
    }
    
    .picks-row {
        display: flex;
        gap: 10px;
        margin-top: 10px;
        flex-wrap: wrap;
    }
    
    .pick-item {
        background: #fff;
        border: 1px solid #e5e3dc;
        border-radius: 10px;
        padding: 10px;
        flex: 1;
        min-width: 160px;
    }
    
    .pick-stock {
        font-weight: 600;
        color: #c96442;
        margin-bottom: 3px;
        font-size: 13px;
    }
    
    .pick-reason {
        font-size: 11px;
        color: #6b6b6b;
    }
    
    .risk-box {
        margin-top: 10px;
        padding: 10px;
        background: #fef2f2;
        border-radius: 10px;
        color: #d64545;
        font-size: 12px;
    }
    
    .key-points-list { list-style: none; }
    
    .key-points-list li {
        padding: 8px 0 8px 16px;
        position: relative;
        border-bottom: 1px solid #f0eeea;
        color: #2d2d2d;
        line-height: 1.6;
        font-size: 13px;
    }
    
    .key-points-list li:last-child { border-bottom: none; }
    
    .key-points-list li::before {
        content: "â–¸";
        position: absolute;
        left: 0;
        color: #c96442;
    }
    
    /* ç©ºç‹€æ…‹ */
    .empty-state {
        text-align: center;
        padding: 50px 20px;
        color: #8b8b8b;
    }
    
    .empty-state .icon { font-size: 36px; margin-bottom: 10px; }
    
    /* RWD */
    @media (max-width: 600px) {
        .container { padding: 10px; }
        .header h1 { font-size: 18px; }
        .db-tab { padding: 8px 16px; font-size: 13px; }
        .filter-row { flex-direction: column; }
        .filter-select { min-width: 100%; }
        .modal-title { font-size: 17px; }
        .hot-tags-list { gap: 4px; }
        .hot-tag { padding: 5px 10px; font-size: 12px; }
    }
</style>
```

</head>
<body>
    <div class="loading-overlay" id="loadingOverlay">
        <div class="loading-spinner"></div>
        <div class="loading-text">æ­£åœ¨è¼‰å…¥ç ”ç©¶å ±å‘Š...</div>
    </div>

```
<div class="container">
    <div class="header">
        <h1>ğŸ“Š Rexå¤§å”æŠ•è³‡ç ”ç©¶å®¤</h1>
        <p class="subtitle">åˆ¸å•†ç ”ç©¶å ±å‘Š Ã— å¤–é›»å¿«å ±æ•´åˆå¹³å°</p>
    </div>
    
    <!-- è³‡æ–™åº«åˆ‡æ› -->
    <div class="db-switcher">
        <button class="db-tab active" data-db="news" onclick="switchDB('news')">
            âš¡ å¤–é›»å¿«å ± <span class="count" id="newsCount">0</span>
        </button>
        <button class="db-tab" data-db="reports" onclick="switchDB('reports')">
            ğŸ“‘ ç”¢æ¥­å±•æœ› <span class="count" id="reportsCount">0</span>
        </button>
        <button class="db-tab" data-db="trends" onclick="switchDB('trends')">
            ğŸ“ˆ ç”¢æ¥­è¶¨å‹¢ <span class="count" id="trendsCount">0</span>
        </button>
    </div>
    
    <!-- æœå°‹å€ -->
    <div class="search-section">
        <div class="main-search">
            <input type="text" id="mainSearchInput" placeholder="æœå°‹å…¬å¸ã€æ¨™ç±¤ã€åˆ¸å•†ã€é—œéµå­—...">
            <div class="search-suggestions" id="searchSuggestions"></div>
        </div>
        
        <!-- ç†±é–€æ¨™ç±¤ -->
        <div class="hot-tags">
            <div class="hot-tags-header">
                <span class="hot-tags-title">ğŸ”¥ ç†±é–€é—œéµå­—</span>
            </div>
            <div class="hot-tags-list" id="hotTagsList"></div>
        </div>
        
        <!-- ç¯©é¸åˆ— -->
        <div class="filter-row">
            <div class="filter-select">
                <select id="brokerFilter">
                    <option value="">æ‰€æœ‰åˆ¸å•†</option>
                </select>
            </div>
            <div class="filter-select" id="categoryFilterWrap">
                <select id="categoryFilter">
                    <option value="">æ‰€æœ‰åˆ†é¡</option>
                </select>
            </div>
            <div class="filter-select" id="importanceFilterWrap">
                <select id="importanceFilter">
                    <option value="">æ‰€æœ‰é‡è¦æ€§</option>
                    <option value="â­â­â­â­â­">â­â­â­â­â­</option>
                    <option value="â­â­â­â­">â­â­â­â­</option>
                    <option value="â­â­â­">â­â­â­</option>
                </select>
            </div>
            <div class="filter-select" id="industryFilterWrap" style="display:none;">
                <select id="industryFilter">
                    <option value="">æ‰€æœ‰ç”¢æ¥­</option>
                </select>
            </div>
            <button class="clear-all-btn" onclick="clearAllFilters()">æ¸…é™¤ç¯©é¸</button>
        </div>
        
        <!-- å·²é¸æ“‡çš„ç¯©é¸ -->
        <div class="active-filters" id="activeFilters"></div>
    </div>
    
    <!-- çµ±è¨ˆåˆ— -->
    <div class="stats-bar">
        <span>æ‰¾åˆ° <strong id="filteredCount">0</strong> ç­†çµæœ</span>
        <div class="sort-options">
            <button class="sort-btn active" data-sort="date" onclick="setSort('date')">æœ€æ–°</button>
            <button class="sort-btn" data-sort="importance" onclick="setSort('importance')">é‡è¦æ€§</button>
        </div>
    </div>
    
    <!-- å ±å‘Šåˆ—è¡¨ -->
    <div class="reports-list" id="reportsList"></div>
</div>

<!-- å½ˆçª— -->
<div class="modal-overlay" id="modalOverlay" onclick="closeModal(event)">
    <div class="modal-content" onclick="event.stopPropagation()">
        <div class="modal-header">
            <div class="modal-header-info" id="modalHeaderInfo"></div>
            <button class="modal-close" onclick="closeModal()">&times;</button>
        </div>
        <div class="modal-body" id="modalBody"></div>
    </div>
</div>

<script>
    // æª”æ¡ˆè·¯å¾‘
    const REPORTS_FILE = 'æŠ•è³‡å±•æœ›å ±å‘Šæ”¶é›†æ¨¡æ¿_æ›´æ–°ç‰ˆ.xlsx';
    const NEWS_FILE = 'å¤–é›»ç¶œåˆå ±å°è³‡æ–™åº«_å®Œæ•´çè—ç‰ˆ.xlsx';
    
    // è³‡æ–™å­˜å„²
    let newsData = [];           // å¤–é›»å¿«å ±
    let newsContent = {};        // å¤–é›»å®Œæ•´å…§å®¹
    let trendsData = [];         // ç”¢æ¥­è¶¨å‹¢
    let reportsData = [];        // ç”¢æ¥­å±•æœ›å ±å‘Š
    let reportDetails = {};
    let stocksData = {};
    let viewpointsData = {};
    
    // ç‹€æ…‹
    let currentDB = 'news';
    let currentSort = 'date';
    let activeFilters = {
        search: '',
        broker: '',
        category: '',
        importance: '',
        industry: '',
        tag: ''
    };
    
    // æœå°‹ç´¢å¼•
    let searchIndex = {
        companies: {},
        tags: {},
        brokers: {},
        categories: {}
    };
    
    // åˆå§‹åŒ–
    window.onload = async function() {
        try {
            await Promise.all([loadNewsData(), loadReportsData()]);
            buildSearchIndex();
            buildFilters();
            buildHotTags();
            updateCounts();
            renderCurrentDB();
            document.getElementById('loadingOverlay').classList.add('hidden');
            
            // ç¶å®šæœå°‹äº‹ä»¶
            const searchInput = document.getElementById('mainSearchInput');
            searchInput.addEventListener('input', onSearchInput);
            searchInput.addEventListener('focus', () => showSuggestions());
            document.addEventListener('click', (e) => {
                if (!e.target.closest('.main-search')) {
                    hideSuggestions();
                }
            });
        } catch (error) {
            console.error('è¼‰å…¥å¤±æ•—:', error);
            document.getElementById('loadingOverlay').innerHTML = `
                <div class="error-message">
                    <h2>âŒ è¼‰å…¥å¤±æ•—</h2>
                    <p>${error.message}</p>
                    <button class="retry-btn" onclick="location.reload()" style="margin-top:20px;padding:12px 30px;background:#c96442;border:none;border-radius:25px;color:#fff;cursor:pointer;">é‡æ–°è¼‰å…¥</button>
                </div>
            `;
        }
    };
    
    // è¼‰å…¥å¤–é›»è³‡æ–™
    async function loadNewsData() {
        const response = await fetch(NEWS_FILE);
        if (!response.ok) throw new Error(`æ‰¾ä¸åˆ°æª”æ¡ˆï¼š${NEWS_FILE}`);
        
        const arrayBuffer = await response.arrayBuffer();
        const workbook = XLSX.read(arrayBuffer, { type: 'array' });
        
        // å ±å°ç¸½è¡¨
        const summarySheet = workbook.Sheets['å ±å°ç¸½è¡¨'];
        if (summarySheet) {
            XLSX.utils.sheet_to_json(summarySheet).forEach(row => {
                if (!row['ç·¨è™Ÿ']) return;
                newsData.push({
                    id: row['ç·¨è™Ÿ'],
                    date: row['æ—¥æœŸ'] || '',
                    company: row['å…¬å¸'] || '',
                    stockCode: row['è‚¡è™Ÿ'] || '',
                    broker: row['åˆ¸å•†ä¾†æº'] || '',
                    category: row['å ±å°é‡é»åˆ†é¡'] || '',
                    importance: row['é‡è¦æ€§'] || '',
                    tags: row['æ¨™ç±¤'] || ''
                });
            });
        }
        
        // å®Œæ•´å…§å®¹æ”¶éŒ„
        const contentSheet = workbook.Sheets['å®Œæ•´å…§å®¹æ”¶éŒ„'];
        if (contentSheet) {
            XLSX.utils.sheet_to_json(contentSheet).forEach(row => {
                if (!row['ç·¨è™Ÿ']) return;
                newsContent[row['ç·¨è™Ÿ']] = row['å®Œæ•´å ±å°å…§å®¹'] || '';
            });
        }
        
        // ç”¢æ¥­è¶¨å‹¢å°ˆå€
        const trendSheet = workbook.Sheets['ç”¢æ¥­è¶¨å‹¢å°ˆå€'];
        if (trendSheet) {
            XLSX.utils.sheet_to_json(trendSheet).forEach(row => {
                if (!row['ç·¨è™Ÿ']) return;
                trendsData.push({
                    id: row['ç·¨è™Ÿ'],
                    date: row['æ—¥æœŸ'] || '',
                    topic: row['ç”¢æ¥­ä¸»é¡Œ'] || '',
                    broker: row['åˆ¸å•†ä¾†æº'] || '',
                    content: row['å®Œæ•´å…§å®¹'] || '',
                    companies: row['ç›¸é—œå…¬å¸ç¾¤'] || '',
                    tags: row['æ¨™ç±¤'] || ''
                });
            });
        }
    }
    
    // è¼‰å…¥ç”¢æ¥­å±•æœ›å ±å‘Š
    async function loadReportsData() {
        const response = await fetch(REPORTS_FILE);
        if (!response.ok) throw new Error(`æ‰¾ä¸åˆ°æª”æ¡ˆï¼š${REPORTS_FILE}`);
        
        const arrayBuffer = await response.arrayBuffer();
        const workbook = XLSX.read(arrayBuffer, { type: 'array' });
        
        // å ±å‘Šç¸½è¦½
        const overviewSheet = workbook.Sheets['å ±å‘Šç¸½è¦½'];
        if (overviewSheet) {
            XLSX.utils.sheet_to_json(overviewSheet).forEach(row => {
                if (!row['å ±å‘Šç·¨è™Ÿ']) return;
                const report = {
                    id: row['å ±å‘Šç·¨è™Ÿ'],
                    broker: row['åˆ¸å•†åç¨±'] || '',
                    date: formatDate(row['å ±å‘Šæ—¥æœŸ']),
                    industry: row['ç”¢æ¥­åç¨±'] || '',
                    title: row['å ±å‘Šæ¨™é¡Œ'] || '',
                    subtitle: row['å‰¯æ¨™é¡Œ'] || '',
                    rating: row['ç”¢æ¥­è©•ç­‰'] || '',
                    analyst: row['åˆ†æå¸«å§“å'] || '',
                    highlights: []
                };
                for (let i = 1; i <= 5; i++) {
                    if (row[`æ ¸å¿ƒé‡é»${i}`]) report.highlights.push(row[`æ ¸å¿ƒé‡é»${i}`]);
                }
                reportsData.push(report);
            });
        }
        
        // ç„¦é»åˆ†æå…§å®¹
        const detailSheet = workbook.Sheets['ç„¦é»åˆ†æå…§å®¹'];
        if (detailSheet) {
            XLSX.utils.sheet_to_json(detailSheet).forEach(row => {
                if (!row['å ±å‘Šç·¨è™Ÿ']) return;
                const id = row['å ±å‘Šç·¨è™Ÿ'];
                if (!reportDetails[id]) reportDetails[id] = [];
                reportDetails[id].push({
                    sectionTitle: row['æ®µè½æ¨™é¡Œ'] || '',
                    content: row['æ®µè½å…§å®¹'] || '',
                    marketSize: row['å¸‚å ´è¦æ¨¡æ•¸æ“š'] || '',
                    growthRate: row['æˆé•·ç‡æ•¸æ“š'] || ''
                });
            });
        }
        
        // å€‹è‚¡è©•åƒ¹è¡¨
        const stocksSheet = workbook.Sheets['å€‹è‚¡è©•åƒ¹è¡¨'];
        if (stocksSheet) {
            XLSX.utils.sheet_to_json(stocksSheet).forEach(row => {
                if (!row['å ±å‘Šç·¨è™Ÿ']) return;
                const id = row['å ±å‘Šç·¨è™Ÿ'];
                if (!stocksData[id]) stocksData[id] = [];
                stocksData[id].push({
                    name: row['å…¬å¸åç¨±'] || '',
                    code: row['è‚¡ç¥¨ä»£è™Ÿ'] || '',
                    rating: row['è©•ç­‰'] || '',
                    price: row['æ”¶ç›¤åƒ¹'],
                    target: row['ç›®æ¨™åƒ¹'],
                    eps25: row['EPS_FY25F'],
                    eps26: row['EPS_FY26F'],
                    highlight: row['æŠ•è³‡äº®é»'] || ''
                });
            });
        }
        
        // åˆ¸å•†è§€é»çµè«–
        const viewpointSheet = workbook.Sheets['åˆ¸å•†è§€é»çµè«–'];
        if (viewpointSheet) {
            XLSX.utils.sheet_to_json(viewpointSheet).forEach(row => {
                if (!row['å ±å‘Šç·¨è™Ÿ']) return;
                const id = row['å ±å‘Šç·¨è™Ÿ'];
                if (!viewpointsData[id]) viewpointsData[id] = [];
                const picks = [];
                for (let i = 1; i <= 3; i++) {
                    if (row[`é¦–é¸å€‹è‚¡${i}`]) {
                        picks.push({ stock: row[`é¦–é¸å€‹è‚¡${i}`], reason: row[`é¦–é¸ç†ç”±${i}`] || '' });
                    }
                }
                viewpointsData[id].push({
                    type: row['è§€é»é¡å‹'] || '',
                    title: row['è§€é»æ¨™é¡Œ'] || '',
                    content: row['è§€é»å…§å®¹'] || '',
                    picks,
                    risk: row['é¢¨éšªæé†’'] || ''
                });
            });
        }
    }
    
    function formatDate(v) {
        if (!v) return '';
        if (typeof v === 'string') return v;
        if (typeof v === 'number') {
            const d = new Date((v - 25569) * 86400 * 1000);
            return d.toLocaleDateString('zh-TW');
        }
        return String(v);
    }
    
    // å»ºç«‹æœå°‹ç´¢å¼•
    function buildSearchIndex() {
        searchIndex = { companies: {}, tags: {}, brokers: {}, categories: {} };
        
        // å¾å¤–é›»è³‡æ–™å»ºç«‹ç´¢å¼•
        newsData.forEach(item => {
            // å…¬å¸
            if (item.company) {
                if (!searchIndex.companies[item.company]) {
                    searchIndex.companies[item.company] = { count: 0, code: item.stockCode };
                }
                searchIndex.companies[item.company].count++;
            }
            
            // æ¨™ç±¤
            if (item.tags) {
                item.tags.split('#').filter(t => t.trim()).forEach(tag => {
                    const t = tag.trim();
                    if (!searchIndex.tags[t]) searchIndex.tags[t] = 0;
                    searchIndex.tags[t]++;
                });
            }
            
            // åˆ¸å•†
            if (item.broker) {
                if (!searchIndex.brokers[item.broker]) searchIndex.brokers[item.broker] = 0;
                searchIndex.brokers[item.broker]++;
            }
            
            // åˆ†é¡
            if (item.category) {
                if (!searchIndex.categories[item.category]) searchIndex.categories[item.category] = 0;
                searchIndex.categories[item.category]++;
            }
        });
        
        // å¾ç”¢æ¥­è¶¨å‹¢å»ºç«‹ç´¢å¼•
        trendsData.forEach(item => {
            if (item.tags) {
                item.tags.split('#').filter(t => t.trim()).forEach(tag => {
                    const t = tag.trim();
                    if (!searchIndex.tags[t]) searchIndex.tags[t] = 0;
                    searchIndex.tags[t]++;
                });
            }
        });
    }
    
    // å»ºç«‹ç¯©é¸é¸é …
    function buildFilters() {
        // åˆ¸å•†
        const brokers = [...new Set([
            ...newsData.map(n => n.broker),
            ...trendsData.map(t => t.broker),
            ...reportsData.map(r => r.broker)
        ])].filter(Boolean).sort();
        
        document.getElementById('brokerFilter').innerHTML = 
            '<option value="">æ‰€æœ‰åˆ¸å•†</option>' + 
            brokers.map(b => `<option value="${b}">${b}</option>`).join('');
        
        // åˆ†é¡
        const categories = [...new Set(newsData.map(n => n.category))].filter(Boolean).sort();
        document.getElementById('categoryFilter').innerHTML = 
            '<option value="">æ‰€æœ‰åˆ†é¡</option>' + 
            categories.map(c => `<option value="${c}">${c}</option>`).join('');
        
        // ç”¢æ¥­
        const industries = [...new Set(reportsData.map(r => r.industry))].filter(Boolean).sort();
        document.getElementById('industryFilter').innerHTML = 
            '<option value="">æ‰€æœ‰ç”¢æ¥­</option>' + 
            industries.map(i => `<option value="${i}">${i}</option>`).join('');
        
        // ç¶å®šäº‹ä»¶
        document.getElementById('brokerFilter').onchange = applyFilters;
        document.getElementById('categoryFilter').onchange = applyFilters;
        document.getElementById('importanceFilter').onchange = applyFilters;
        document.getElementById('industryFilter').onchange = applyFilters;
    }
    
    // å»ºç«‹ç†±é–€æ¨™ç±¤
    function buildHotTags() {
        const topTags = Object.entries(searchIndex.tags)
            .sort((a, b) => b[1] - a[1])
            .slice(0, 12);
        
        document.getElementById('hotTagsList').innerHTML = topTags.map(([tag, count]) => 
            `<button class="hot-tag" onclick="searchByTag('${tag}')">#${tag}</button>`
        ).join('');
    }
    
    // æœå°‹è¼¸å…¥è™•ç†
    function onSearchInput(e) {
        const query = e.target.value.trim().toLowerCase();
        if (query.length > 0) {
            showSuggestions(query);
        } else {
            hideSuggestions();
        }
        
        // å³æ™‚æœå°‹
        activeFilters.search = query;
        renderCurrentDB();
    }
    
    // é¡¯ç¤ºæœå°‹å»ºè­°
    function showSuggestions(query = '') {
        const container = document.getElementById('searchSuggestions');
        
        if (!query) {
            // é¡¯ç¤ºç†±é–€æœå°‹
            const topCompanies = Object.entries(searchIndex.companies)
                .sort((a, b) => b[1].count - a[1].count)
                .slice(0, 5);
            const topTags = Object.entries(searchIndex.tags)
                .sort((a, b) => b[1] - a[1])
                .slice(0, 5);
            
            container.innerHTML = `
                <div class="suggestion-group">
                    <div class="suggestion-group-title">ç†±é–€å…¬å¸</div>
                    ${topCompanies.map(([name, data]) => `
                        <div class="suggestion-item" onclick="searchByCompany('${name}')">
                            <div class="suggestion-icon company">ğŸ¢</div>
                            <div class="suggestion-text">
                                <div class="suggestion-main">${name}</div>
                                <div class="suggestion-sub">${data.code || ''}</div>
                            </div>
                            <span class="suggestion-count">${data.count}ç­†</span>
                        </div>
                    `).join('')}
                </div>
                <div class="suggestion-group">
                    <div class="suggestion-group-title">ç†±é–€æ¨™ç±¤</div>
                    ${topTags.map(([tag, count]) => `
                        <div class="suggestion-item" onclick="searchByTag('${tag}')">
                            <div class="suggestion-icon tag">ğŸ·ï¸</div>
                            <div class="suggestion-text">
                                <div class="suggestion-main">#${tag}</div>
                            </div>
                            <span class="suggestion-count">${count}ç­†</span>
                        </div>
                    `).join('')}
                </div>
            `;
            container.classList.add('active');
            return;
        }
        
        // æœå°‹åŒ¹é…
        const matchedCompanies = Object.entries(searchIndex.companies)
            .filter(([name]) => name.toLowerCase().includes(query))
            .sort((a, b) => b[1].count - a[1].count)
            .slice(0, 5);
        
        const matchedTags = Object.entries(searchIndex.tags)
            .filter(([tag]) => tag.toLowerCase().includes(query))
            .sort((a, b) => b[1] - a[1])
            .slice(0, 5);
        
        const matchedBrokers = Object.entries(searchIndex.brokers)
            .filter(([broker]) => broker.toLowerCase().includes(query))
            .sort((a, b) => b[1] - a[1])
            .slice(0, 3);
        
        const matchedCategories = Object.entries(searchIndex.categories)
            .filter(([cat]) => cat.toLowerCase().includes(query))
            .sort((a, b) => b[1] - a[1])
            .slice(0, 3);
        
        let html = '';
        
        if (matchedCompanies.length > 0) {
            html += `<div class="suggestion-group">
                <div class="suggestion-group-title">å…¬å¸</div>
                ${matchedCompanies.map(([name, data]) => `
                    <div class="suggestion-item" onclick="searchByCompany('${name}')">
                        <div class="suggestion-icon company">ğŸ¢</div>
                        <div class="suggestion-text">
                            <div class="suggestion-main">${highlightMatch(name, query)}</div>
                            <div class="suggestion-sub">${data.code || ''}</div>
                        </div>
                        <span class="suggestion-count">${data.count}ç­†</span>
                    </div>
                `).join('')}
            </div>`;
        }
        
        if (matchedTags.length > 0) {
            html += `<div class="suggestion-group">
                <div class="suggestion-group-title">æ¨™ç±¤</div>
                ${matchedTags.map(([tag, count]) => `
                    <div class="suggestion-item" onclick="searchByTag('${tag}')">
                        <div class="suggestion-icon tag">ğŸ·ï¸</div>
                        <div class="suggestion-text">
                            <div class="suggestion-main">#${highlightMatch(tag, query)}</div>
                        </div>
                        <span class="suggestion-count">${count}ç­†</span>
                    </div>
                `).join('')}
            </div>`;
        }
        
        if (matchedBrokers.length > 0) {
            html += `<div class="suggestion-group">
                <div class="suggestion-group-title">åˆ¸å•†</div>
                ${matchedBrokers.map(([broker, count]) => `
                    <div class="suggestion-item" onclick="searchByBroker('${broker}')">
                        <div class="suggestion-icon broker">ğŸ¦</div>
                        <div class="suggestion-text">
                            <div class="suggestion-main">${highlightMatch(broker, query)}</div>
                        </div>
                        <span class="suggestion-count">${count}ç­†</span>
                    </div>
                `).join('')}
            </div>`;
        }
        
        if (matchedCategories.length > 0) {
            html += `<div class="suggestion-group">
                <div class="suggestion-group-title">åˆ†é¡</div>
                ${matchedCategories.map(([cat, count]) => `
                    <div class="suggestion-item" onclick="searchByCategory('${cat}')">
                        <div class="suggestion-icon category">ğŸ“</div>
                        <div class="suggestion-text">
                            <div class="suggestion-main">${highlightMatch(cat, query)}</div>
                        </div>
                        <span class="suggestion-count">${count}ç­†</span>
                    </div>
                `).join('')}
            </div>`;
        }
        
        if (html) {
            container.innerHTML = html;
            container.classList.add('active');
        } else {
            hideSuggestions();
        }
    }
    
    function hideSuggestions() {
        document.getElementById('searchSuggestions').classList.remove('active');
    }
    
    function highlightMatch(text, query) {
        const regex = new RegExp(`(${query})`, 'gi');
        return text.replace(regex, '<strong style="color:#c96442;">$1</strong>');
    }
    
    // å¿«é€Ÿæœå°‹åŠŸèƒ½
    function searchByCompany(company) {
        document.getElementById('mainSearchInput').value = company;
        activeFilters.search = company.toLowerCase();
        hideSuggestions();
        renderCurrentDB();
    }
    
    function searchByTag(tag) {
        document.getElementById('mainSearchInput').value = '#' + tag;
        activeFilters.search = '';
        activeFilters.tag = tag;
        hideSuggestions();
        updateActiveFiltersDisplay();
        renderCurrentDB();
        
        // æ›´æ–°ç†±é–€æ¨™ç±¤æŒ‰éˆ•ç‹€æ…‹
        document.querySelectorAll('.hot-tag').forEach(btn => {
            btn.classList.toggle('active', btn.textContent === '#' + tag);
        });
    }
    
    function searchByBroker(broker) {
        document.getElementById('brokerFilter').value = broker;
        activeFilters.broker = broker;
        hideSuggestions();
        document.getElementById('mainSearchInput').value = '';
        updateActiveFiltersDisplay();
        renderCurrentDB();
    }
    
    function searchByCategory(category) {
        document.getElementById('categoryFilter').value = category;
        activeFilters.category = category;
        hideSuggestions();
        document.getElementById('mainSearchInput').value = '';
        updateActiveFiltersDisplay();
        renderCurrentDB();
    }
    
    // åˆ‡æ›è³‡æ–™åº«
    function switchDB(db) {
        currentDB = db;
        document.querySelectorAll('.db-tab').forEach(tab => {
            tab.classList.toggle('active', tab.dataset.db === db);
        });
        
        // é¡¯ç¤º/éš±è—å°æ‡‰çš„ç¯©é¸å™¨
        document.getElementById('categoryFilterWrap').style.display = (db === 'news') ? 'block' : 'none';
        document.getElementById('importanceFilterWrap').style.display = (db === 'news') ? 'block' : 'none';
        document.getElementById('industryFilterWrap').style.display = (db === 'reports') ? 'block' : 'none';
        
        renderCurrentDB();
    }
    
    // å¥—ç”¨ç¯©é¸
    function applyFilters() {
        activeFilters.broker = document.getElementById('brokerFilter').value;
        activeFilters.category = document.getElementById('categoryFilter').value;
        activeFilters.importance = document.getElementById('importanceFilter').value;
        activeFilters.industry = document.getElementById('industryFilter').value;
        updateActiveFiltersDisplay();
        renderCurrentDB();
    }
    
    // æ›´æ–°å·²é¸ç¯©é¸é¡¯ç¤º
    function updateActiveFiltersDisplay() {
        const container = document.getElementById('activeFilters');
        let html = '';
        
        if (activeFilters.tag) {
            html += `<span class="active-filter">#${activeFilters.tag} <span class="remove" onclick="removeFilter('tag')">âœ•</span></span>`;
        }
        if (activeFilters.broker) {
            html += `<span class="active-filter">${activeFilters.broker} <span class="remove" onclick="removeFilter('broker')">âœ•</span></span>`;
        }
        if (activeFilters.category) {
            html += `<span class="active-filter">${activeFilters.category} <span class="remove" onclick="removeFilter('category')">âœ•</span></span>`;
        }
        if (activeFilters.importance) {
            html += `<span class="active-filter">${activeFilters.importance} <span class="remove" onclick="removeFilter('importance')">âœ•</span></span>`;
        }
        if (activeFilters.industry) {
            html += `<span class="active-filter">${activeFilters.industry} <span class="remove" onclick="removeFilter('industry')">âœ•</span></span>`;
        }
        
        container.innerHTML = html;
    }
    
    function removeFilter(type) {
        activeFilters[type] = '';
        if (type === 'broker') document.getElementById('brokerFilter').value = '';
        if (type === 'category') document.getElementById('categoryFilter').value = '';
        if (type === 'importance') document.getElementById('importanceFilter').value = '';
        if (type === 'industry') document.getElementById('industryFilter').value = '';
        if (type === 'tag') {
            document.getElementById('mainSearchInput').value = '';
            document.querySelectorAll('.hot-tag').forEach(btn => btn.classList.remove('active'));
        }
        updateActiveFiltersDisplay();
        renderCurrentDB();
    }
    
    function clearAllFilters() {
        activeFilters = { search: '', broker: '', category: '', importance: '', industry: '', tag: '' };
        document.getElementById('mainSearchInput').value = '';
        document.getElementById('brokerFilter').value = '';
        document.getElementById('categoryFilter').value = '';
        document.getElementById('importanceFilter').value = '';
        document.getElementById('industryFilter').value = '';
        document.querySelectorAll('.hot-tag').forEach(btn => btn.classList.remove('active'));
        updateActiveFiltersDisplay();
        renderCurrentDB();
    }
    
    // æ’åº
    function setSort(sort) {
        currentSort = sort;
        document.querySelectorAll('.sort-btn').forEach(btn => {
            btn.classList.toggle('active', btn.dataset.sort === sort);
        });
        renderCurrentDB();
    }
    
    // æ›´æ–°æ•¸é‡
    function updateCounts() {
        document.getElementById('newsCount').textContent = newsData.length;
        document.getElementById('reportsCount').textContent = reportsData.length;
        document.getElementById('trendsCount').textContent = trendsData.length;
    }
    
    // æ¸²æŸ“ç•¶å‰è³‡æ–™åº«
    function renderCurrentDB() {
        if (currentDB === 'news') {
            renderNews();
        } else if (currentDB === 'reports') {
            renderReports();
        } else if (currentDB === 'trends') {
            renderTrends();
        }
    }
    
    // æ¸²æŸ“å¤–é›»å¿«å ±
    function renderNews() {
        let filtered = newsData.filter(item => {
            if (activeFilters.search) {
                const searchText = [
                    item.company, item.stockCode, item.broker, item.category, item.tags,
                    newsContent[item.id] || ''
                ].join(' ').toLowerCase();
                if (!searchText.includes(activeFilters.search)) return false;
            }
            if (activeFilters.tag && !item.tags.includes(activeFilters.tag)) return false;
            if (activeFilters.broker && item.broker !== activeFilters.broker) return false;
            if (activeFilters.category && item.category !== activeFilters.category) return false;
            if (activeFilters.importance && item.importance !== activeFilters.importance) return false;
            return true;
        });
        
        // æ’åº
        if (currentSort === 'importance') {
            filtered.sort((a, b) => (b.importance?.length || 0) - (a.importance?.length || 0));
        } else {
            filtered.sort((a, b) => String(b.date).localeCompare(String(a.date)));
        }
        
        document.getElementById('filteredCount').textContent = filtered.length;
        
        const list = document.getElementById('reportsList');
        if (filtered.length === 0) {
            list.innerHTML = `<div class="empty-state"><div class="icon">ğŸ”</div><p>æ²’æœ‰ç¬¦åˆæ¢ä»¶çš„å ±å°</p></div>`;
            return;
        }
        
        list.innerHTML = filtered.map(item => {
            const content = newsContent[item.id] || '';
            const preview = content.replace(/â€¢/g, '').substring(0, 120);
            const tags = item.tags.split('#').filter(t => t.trim()).slice(0, 4);
            
            return `
                <div class="news-card" onclick="openNewsModal('${item.id}')">
                    <div class="news-card-header">
                        <div class="news-card-left">
                            <span class="company-badge">${item.company}</span>
                            ${item.stockCode && item.stockCode !== '-' ? `<span class="stock-code">${item.stockCode}</span>` : ''}
                        </div>
                        <span class="importance-stars">${item.importance}</span>
                    </div>
                    <div class="news-card-meta">
                        <span class="broker-tag">${item.broker}</span>
                        <span class="category-tag">${item.category}</span>
                        <span class="date-tag">${item.date}</span>
                    </div>
                    <div class="news-card-content">${preview}...</div>
                    <div class="news-card-tags">
                        ${tags.map(t => `<span class="mini-tag" onclick="event.stopPropagation();searchByTag('${t.trim()}')">#${t.trim()}</span>`).join('')}
                    </div>
                </div>
            `;
        }).join('');
    }
    
    // æ¸²æŸ“ç”¢æ¥­å±•æœ›
    function renderReports() {
        let filtered = reportsData.filter(report => {
            if (activeFilters.search) {
                const stocks = stocksData[report.id] || [];
                const details = reportDetails[report.id] || [];
                const searchText = [
                    report.title, report.subtitle, report.broker, report.industry,
                    report.highlights.join(' '),
                    stocks.map(s => `${s.name} ${s.code} ${s.highlight || ''}`).join(' '),
                    details.map(d => `${d.sectionTitle} ${d.content}`).join(' ')
                ].join(' ').toLowerCase();
                if (!searchText.includes(activeFilters.search)) return false;
            }
            if (activeFilters.broker && report.broker !== activeFilters.broker) return false;
            if (activeFilters.industry && report.industry !== activeFilters.industry) return false;
            return true;
        });
        
        filtered.sort((a, b) => String(b.date).localeCompare(String(a.date)));
        
        document.getElementById('filteredCount').textContent = filtered.length;
        
        const list = document.getElementById('reportsList');
        if (filtered.length === 0) {
            list.innerHTML = `<div class="empty-state"><div class="icon">ğŸ”</div><p>æ²’æœ‰ç¬¦åˆæ¢ä»¶çš„å ±å‘Š</p></div>`;
            return;
        }
        
        list.innerHTML = filtered.map(report => {
            const stocks = stocksData[report.id] || [];
            const ratingClass = report.rating.includes('å„ªæ–¼') ? 'positive' : 
                               report.rating.includes('åŠ£æ–¼') ? 'negative' : 'neutral';
            return `
                <div class="report-card" onclick="openReportModal('${report.id}')">
                    <div class="card-top">
                        <div class="card-meta">
                            <span class="card-broker">${report.broker}</span>
                            <span class="card-date">${report.date}</span>
                        </div>
                        <span class="card-industry">${report.industry}</span>
                    </div>
                    <h3 class="card-title">${report.title}</h3>
                    ${report.subtitle ? `<p class="card-subtitle">${report.subtitle}</p>` : ''}
                    ${report.rating ? `<div class="card-rating"><span class="rating-label">è©•ç­‰</span><span class="rating-value ${ratingClass}">${report.rating}</span></div>` : ''}
                    <div class="card-highlights">
                        ${report.highlights.slice(0, 2).map(h => `<div class="highlight-item">${truncate(h, 55)}</div>`).join('')}
                    </div>
                    ${stocks.length > 0 ? `<div class="card-stocks">${stocks.slice(0, 4).map(s => `<span class="stock-tag">${s.name}</span>`).join('')}${stocks.length > 4 ? `<span class="stock-tag">+${stocks.length - 4}</span>` : ''}</div>` : ''}
                </div>
            `;
        }).join('');
    }
    
    // æ¸²æŸ“ç”¢æ¥­è¶¨å‹¢
    function renderTrends() {
        let filtered = trendsData.filter(item => {
            if (activeFilters.search) {
                const searchText = [item.topic, item.broker, item.content, item.companies, item.tags].join(' ').toLowerCase();
                if (!searchText.includes(activeFilters.search)) return false;
            }
            if (activeFilters.tag && !item.tags.includes(activeFilters.tag)) return false;
            if (activeFilters.broker && item.broker !== activeFilters.broker) return false;
            return true;
        });
        
        filtered.sort((a, b) => String(b.date).localeCompare(String(a.date)));
        
        document.getElementById('filteredCount').textContent = filtered.length;
        
        const list = document.getElementById('reportsList');
        if (filtered.length === 0) {
            list.innerHTML = `<div class="empty-state"><div class="icon">ğŸ”</div><p>æ²’æœ‰ç¬¦åˆæ¢ä»¶çš„è¶¨å‹¢å ±å°</p></div>`;
            return;
        }
        
        list.innerHTML = filtered.map(item => {
            const tags = item.tags.split('#').filter(t => t.trim()).slice(0, 4);
            return `
                <div class="trend-card" onclick="openTrendModal('${item.id}')">
                    <span class="trend-badge">ğŸ“ˆ ç”¢æ¥­è¶¨å‹¢</span>
                    <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:6px;">
                        <span class="broker-tag">${item.broker}</span>
                        <span class="date-tag">${item.date}</span>
                    </div>
                    <h3 class="trend-title">${item.topic}</h3>
                    <p class="trend-companies">ğŸ“Œ ${item.companies}</p>
                    <p class="trend-content">${item.content.substring(0, 100)}...</p>
                    <div class="news-card-tags" style="margin-top:8px;">
                        ${tags.map(t => `<span class="mini-tag">#${t.trim()}</span>`).join('')}
                    </div>
                </div>
            `;
        }).join('');
    }
    
    function truncate(text, max) {
        return text && text.length > max ? text.substring(0, max) + '...' : (text || '');
    }
    
    // é–‹å•Ÿå¤–é›»å¿«å ±å½ˆçª—
    function openNewsModal(id) {
        const item = newsData.find(n => n.id == id);
        if (!item) return;
        
        const content = newsContent[id] || '';
        const tags = item.tags.split('#').filter(t => t.trim());
        
        document.getElementById('modalHeaderInfo').innerHTML = `
            <div class="modal-meta">
                <span class="modal-meta-item broker">${item.broker}</span>
                <span class="modal-meta-item date">ğŸ“… ${item.date}</span>
                <span class="modal-meta-item category">${item.category}</span>
                <span class="modal-meta-item importance">${item.importance}</span>
            </div>
            <h2 class="modal-title">${item.company} ${item.stockCode && item.stockCode !== '-' ? `(${item.stockCode})` : ''}</h2>
        `;
        
        document.getElementById('modalBody').innerHTML = `
            <div class="modal-section">
                <h3 class="section-title">ğŸ“ å®Œæ•´å ±å°å…§å®¹</h3>
                <div class="content-block">${content}</div>
            </div>
            <div class="modal-section">
                <h3 class="section-title">ğŸ·ï¸ ç›¸é—œæ¨™ç±¤</h3>
                <div class="tags-block">
                    ${tags.map(t => `<span class="modal-tag" onclick="searchByTag('${t}');closeModal();">#${t}</span>`).join('')}
                </div>
            </div>
        `;
        
        openModal();
    }
    
    // é–‹å•Ÿç”¢æ¥­è¶¨å‹¢å½ˆçª—
    function openTrendModal(id) {
        const item = trendsData.find(t => t.id == id);
        if (!item) return;
        
        const tags = item.tags.split('#').filter(t => t.trim());
        const companies = item.companies.split('ã€').filter(c => c.trim());
        
        document.getElementById('modalHeaderInfo').innerHTML = `
            <div class="modal-meta">
                <span class="modal-meta-item broker">${item.broker}</span>
                <span class="modal-meta-item date">ğŸ“… ${item.date}</span>
                <span class="modal-meta-item category">ç”¢æ¥­è¶¨å‹¢</span>
            </div>
            <h2 class="modal-title">${item.topic}</h2>
        `;
        
        document.getElementById('modalBody').innerHTML = `
            <div class="modal-section">
                <h3 class="section-title">ğŸ¢ ç›¸é—œå…¬å¸</h3>
                <div class="companies-block">
                    ${companies.map(c => `<span class="company-chip" onclick="searchByCompany('${c.replace(/\([^)]*\)/g, '').trim()}');closeModal();">ğŸ¢ ${c}</span>`).join('')}
                </div>
            </div>
            <div class="modal-section">
                <h3 class="section-title">ğŸ“ å®Œæ•´å…§å®¹</h3>
                <div class="content-block">${item.content}</div>
            </div>
            <div class="modal-section">
                <h3 class="section-title">ğŸ·ï¸ ç›¸é—œæ¨™ç±¤</h3>
                <div class="tags-block">
                    ${tags.map(t => `<span class="modal-tag" onclick="searchByTag('${t}');closeModal();">#${t}</span>`).join('')}
                </div>
            </div>
        `;
        
        openModal();
    }
    
    // é–‹å•Ÿç”¢æ¥­å ±å‘Šå½ˆçª—
    function openReportModal(id) {
        const report = reportsData.find(r => r.id === id);
        if (!report) return;
        
        const details = reportDetails[id] || [];
        const stocks = stocksData[id] || [];
        const viewpoints = viewpointsData[id] || [];
        
        document.getElementById('modalHeaderInfo').innerHTML = `
            <div class="modal-meta">
                <span class="modal-meta-item broker">${report.broker}</span>
                <span class="modal-meta-item date">ğŸ“… ${report.date}</span>
                <span class="modal-meta-item category">${report.industry}</span>
            </div>
            <h2 class="modal-title">${report.title}</h2>
            ${report.subtitle ? `<p class="modal-subtitle">${report.subtitle}</p>` : ''}
        `;
        
        let html = '';
        
        if (report.highlights.length > 0) {
            html += `<div class="modal-section"><h3 class="section-title">ğŸ“Œ æ ¸å¿ƒé‡é»</h3><ul class="key-points-list">${report.highlights.map(h => `<li>${h}</li>`).join('')}</ul></div>`;
        }
        
        if (details.length > 0) {
            html += `<div class="modal-section"><h3 class="section-title">ğŸ“Š ç„¦é»åˆ†æ</h3>${details.map(d => `
                <div class="viewpoint-card">
                    <div class="viewpoint-title">${d.sectionTitle}</div>
                    <div class="viewpoint-content">${d.content}</div>
                    ${d.marketSize ? `<div style="margin-top:6px;color:#c96442;font-size:12px;">ğŸ“ˆ ${d.marketSize}</div>` : ''}
                    ${d.growthRate ? `<div style="color:#5a9e6f;font-size:12px;">ğŸ“Š ${d.growthRate}</div>` : ''}
                </div>
            `).join('')}</div>`;
        }
        
        if (stocks.length > 0) {
            html += `<div class="modal-section"><h3 class="section-title">ğŸ“ˆ å€‹è‚¡è©•åƒ¹</h3>
                <div class="stocks-table-wrapper"><table class="stocks-table">
                    <thead><tr><th>å…¬å¸</th><th>è©•ç­‰</th><th>æ”¶ç›¤</th><th>ç›®æ¨™</th><th>25F EPS</th><th>26F EPS</th><th>äº®é»</th></tr></thead>
                    <tbody>${stocks.map(s => `
                        <tr>
                            <td><div class="stock-name-cell">${s.name}</div><div class="stock-code-cell">${s.code}</div></td>
                            <td><span class="stock-rating-badge ${s.rating === 'è²·é€²' ? 'buy' : 'hold'}">${s.rating}</span></td>
                            <td>${s.price || '-'}</td><td>${s.target || '-'}</td>
                            <td>${s.eps25 || '-'}</td><td>${s.eps26 || '-'}</td>
                            <td>${s.highlight || '-'}</td>
                        </tr>
                    `).join('')}</tbody>
                </table></div></div>`;
        }
        
        if (viewpoints.length > 0) {
            html += `<div class="modal-section"><h3 class="section-title">ğŸ’¡ åˆ¸å•†è§€é»</h3>${viewpoints.map(v => `
                <div class="viewpoint-card">
                    <div class="viewpoint-title">${v.title || v.type}</div>
                    <div class="viewpoint-content">${v.content}</div>
                    ${v.picks.length > 0 ? `<div class="picks-row">${v.picks.map(p => `
                        <div class="pick-item">
                            <div class="pick-stock">â­ ${p.stock}</div>
                            <div class="pick-reason">${p.reason}</div>
                        </div>
                    `).join('')}</div>` : ''}
                    ${v.risk ? `<div class="risk-box">âš ï¸ ${v.risk}</div>` : ''}
                </div>
            `).join('')}</div>`;
        }
        
        document.getElementById('modalBody').innerHTML = html;
        openModal();
    }
    
    function openModal() {
        document.getElementById('modalOverlay').classList.add('active');
        document.body.style.overflow = 'hidden';
    }
    
    function closeModal(e) {
        if (e && e.target !== document.getElementById('modalOverlay')) return;
        document.getElementById('modalOverlay').classList.remove('active');
        document.body.style.overflow = '';
    }
    
    document.addEventListener('keydown', e => { if (e.key === 'Escape') closeModal(); });
</script>
```

</body>
</html>